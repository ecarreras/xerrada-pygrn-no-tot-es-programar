  <!DOCTYPE html>
<html>
  <head>
 ¬† ¬†<title>No tot √©s programar!</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Roboto);
      @import url(https://fonts.googleapis.com/css?family=Roboto+Mono);

      body { font-family: 'Roboto'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-code, .remark-inline-code { font-family: 'Roboto Mono'; font-size: 0.6em }
    </style>
  </head>
  <body>
    <textarea id="source">

class: center, middle

# No tot √©s programar!
## Documentar, testejar, integrar, desplegar i monitoritzar

![PyGRN](https://avatars1.githubusercontent.com/u/28831124?v=4&s=200)

[Eduard Carreras i Nadal](mailto:ecarreras@gmail.com)

13/09/2017 - PyGRN #2

[![](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)

---

# Agenda

  1. Qui s√≥c jo?
  2. Introducci√≥
  3. Documentaci√≥ de projectes
  4. Testing: Metodologia TDD i cl√†ssica i eines
  5. Integraci√≥: Concepte
  6. Desplegament: Concepte i algunes eines
  7. Monitoritzar un cop desplegat

---

# Qui s√≥c jo?

- S√≥c un infiltrat en el m√≥n del software (s√≥c teleco)
- Apasionat del software i del proƒáes **art**esanal que hi ha al darrera
- Co-Fundador de [GISCE-TI, S.L](http://gisce.net)
- Desenvolupant en Python des del 2007 (Python ‚ù§Ô∏è)
- Apasionat del programari lliure
- [LinkedIn](https://www.linkedin.com/in/ecarreras/), [Twitter](https://twitter.com/ecarreras)
  i [GitHub](https://github.com/ecarreras)

---

# Introducci√≥

- No tot √©s programar!
- Codi, codi, codi ...
- Cicle de vida d'una aplicaci√≥

---

# Documentaci√≥ de projectes

- Documentaci√≥ t√®cnica (APIs)
- Documentaci√≥ d'usuari (manuals)

---

## Documentaci√≥ t√®cnica (APIs)

- [PEP 257 -- Docstring Conventions](https://www.python.org/dev/peps/pep-0257/)

  A docstring is a string literal that occurs as the first statement in a module,
  function, class, or method definition. Such a docstring becomes the `__doc__`
  special attribute of that object.

```python
"""Aquest m√≤dul de python t√© funcions per saludar"""


def hola():
    """Aix√≤ imprimeix Hola!"""
    print('Hola')
```

- Podem consulta la pr√≤pia ajuda des de l'entorn python `help(hola)`
  o `hola.__doc__`

- Ens haur√≠em d'acostumar m√©s a escriure *docstrings* com a documentaci√≥ t√®cnica
  no nom√©s les signatures de les funcions

---
## Documentaci√≥ t√®cnica (APIs) - Hist√≤ria

- No hi havia cap est√†ndard definit.
- Qu√® passa quan es vol *enriquir* una mica el text?
  - HTML, DocBook, TeX, ...

### Objectius

 - Ha de ser f√†cil de llegir des del propi codi font
 - F√†cil d'escriure des de qualsevol editor
 - No ha de tenir informaci√≥ que hagi de ser deduida de parsejar el m√≤darcula
 - Ha de tenir suficinent *estructura* per poder-se convertir a altres formats
 - Ha de ser f√†cil escriure **tota** la documentaci√≥ d'un m√≤dul sense fer sentir
   sobrecarregat

### Soluci√≥

 - [PEP 287 -- reStructuredText Docstring Format](https://www.python.org/dev/peps/pep-0287/)

---

## Documentaci√≥ t√®cnica (APIs) - ReStructuredText exemple

```python
class Keeper(Storer):

    """Keep data fresher longer.

    Extend `Storer`.  Class attribute `instances` keeps track
    of the number of `Keeper` objects instantiated.
    """

    instances = 0
    """How many `Keeper` objects are there?"""

    def __init__(self):
        """
        Extend `Storer.__init__()` to keep track of
        instances.  Keep count in `self.instances` and data
        in `self.data`.
        """
        Storer.__init__(self)
        self.instances += 1

        self.data = []
        """Store data in a list, most recent last."""

    def storedata(self, data):
        """
        Extend `Storer.storedata()`; append new `data` to a
        list (in `self.data`).
        """
        self.data = data
```
---
## Documentaci√≥ t√®cnica (APIs) - Metainformaci√≥

- Diferents formats de metainformaci√≥
  - ReStructuredText
  - [Google](http://google.github.io/styleguide/pyguide.html?showone=Comments#Comments)
  - [Numpy](https://github.com/numpy/numpy/blob/master/doc/HOWTO_DOCUMENT.rst.txt)
  - [PEP 3107 -- Function Annotations](https://www.python.org/dev/peps/pep-3107/)
    (nom√©s Python 3!)

### ReStructuredText

```python
def stupid_method(first, second):
    """Aquest m√®tode retorna la suma dels dos par√†metres.

    :param int first: El primer par√†mentre
    :param int second: El segon par√†mentre
    :return: La suma dels par√†metres
    :rtype: int
    :raises ValueError: Si algun dels dos par√†metres no √©s un enter
    """
    if not (isinstance(first, int) and isinstance(second int)):
        raise ValueError("must be integers!")
    return first + second
```

---
## Documentaci√≥ t√®cnica (APIs) - Metainformaci√≥
### Google

```python
def stupid_method(first, second):
    """Aquest m√®tode retorna la suma dels dos par√†metres.

    Args:
        first: Un int com a primer par√†metre.
        second: Un int com a segon par√†metre.

    Returns:
        Un int corresponent a la suma dels par√†metres

    Raises:
        ValueError: Si algun dels dos par√†metres no √©s un enter
    """
    if not (isinstance(first, int) and isinstance(second, int)):
        raise ValueError("must be integers!")
    return first + second
```
---

## Documentaci√≥ t√®cnica (APIs) - Metainformaci√≥
### Numpy

```python
def stupid_method(first, second):
    """Aquest m√®tode retorna la suma dels dos par√†metres.

    Parametres
    ----------
    first: int
           Un int com a primer par√†metre.
    second: int
            Un int com a segon par√†metre.

    Returns
    -------
    int
        La suma dels par√†metres

    Raises
    ------
    ValueError
        Si algun dels dos par√†metres no √©s un enter
    """
    if not (isinstance(first, int) and isinstance(second, int)):
        raise ValueError("must be integers!")
    return first + second
```

---

## Documentaci√≥ t√®cnica (APIs) - Metainformaci√≥
### Function Annotations

```python
def stupid_method(first: int, second: int) -> int:
    """Aquest m√®tode retorna la suma dels dos par√†metres.

    :param first: El primer par√†mentre
    :param second: El segon par√†mentre
    :return: La suma dels par√†metres
    :raises ValueError: Si algun dels dos par√†metres no √©s un enter
    """
    if not (isinstance(first, int) and isinstance(second, int)):
        raise ValueError("must be integers!")
    return first + second
```

```python
def stupid_method(first: "El primer par√†mentre",
                  second: "El segon par√†mentre") -> "La suma dels par√†metres":
    """Aquest m√®tode retorna la suma dels dos par√†metres.

    :raises ValueError: Si algun dels dos par√†metres no √©s un enter
    """
    if not (isinstance(first, int) and isinstance(second, int)):
        raise ValueError("must be integers!")
    return first + second
```

- Podem accedir a la informaci√≥ des l'int√®rpret. `supid_method.func_annotations`
  i retorna un diccionari amb les anotacions.

---

## Documentaci√≥ t√®cnica (APIs) - Doctest

- Barreja entre tenir documentaci√≥, exemples i tests. (3 en 1).
- La [documentaci√≥ de doctest](https://docs.python.org/3/library/doctest.html)
  √©s molt extensa i permet moltes coses.

```python
def stupid_method(first, second):
    """Aquest m√®tode retorna la suma dels dos par√†metres.

    >>> stupid_method(1, 2)
    3
    >>> stupid_method("a", 2)
    Traceback (most recent call last):
      ...
    ValueError: must be integers!
    >>> stupid_method(1, "a")
    Traceback (most recent call last):
      ...
    ValueError: must be integers!
    """
    if not (isinstance(first, int) and isinstance(second, int)):
        raise ValueError("must be integers!")
    return first + second

if __name__ == '__main__':
    import doctest
    doctest.testmod()
```

- Podem llan√ßar els tests directament amb:

```sh
$ python stupid.py -v
```

---

## Documentaci√≥ t√®cnica (APIs) - Eina
### [Sphinx](http://www.sphinx-doc.org)

√âs una eina per **crear documentaci√≥** i podem destacar les seg√ºents funcionalitats:
  - **Diferents formats de sortida**: HTML (diferents temes), WinHelp,
    LaTeX (pels PDFs), ePub, Texinfo, manpages, text pla.
  - **Refer√®ncies creuades**: Enlla√ßos sem√†ntics autom√†tics de funcions, classes,
    definicions, ... Fins i tot d'altres documentacions!
  - **Estructura jer√†rquica**: Tot queda organitzat en arbre.
  - **√çndex autom√†tics**: √çndex general i tamb√© de tots els m√≤duls.
  - **Visualitzaci√≥ de codi**: Fent servir la llibreria de resaltat [Pygments](http://pygments.org/)
  - **Extensible**: [Extensions pr√≤pies](http://www.sphinx-doc.org/en/stable/ext/builtins.html#builtin-sphinx-extensions)
    o de tercers [instal¬∑lables des de Pypi](https://pypi.org/search/?q=sphinx+extension)

T√© un assistent per la creaci√≥ de projectes:

```sh
$ pip install Sphinx
$ sphinx-quickstart my-project
```

---

## Documentaci√≥ d'usuari (on i com?)

- ~~Processadors de text~~

  **Al carrer!** El descartem directament.

  - Formats pesats i normalment binaris
  - Dificultat per fer edici√≥ per parts o distribu√Øda
  - Dificultat per gestionar un hist√≤ric de canvis
  - Dificultat per gestionar revisions de canvis i ampliacions

  **Spoiler**: Tracte el teu manual com si fos codi.

  - Fes servir un format de text pla que pugui ser escrit i editat des de
    qualsevol editor.
  - Guarda el manual en un repositori de control de versions (Git)
  - Podem editar per parts o de forma distribu√Øda gr√†cies el control de versions
  - Tenim hist√≤ric!
  - Tenim un sistema de *Pull requests* per revisar i aprovar canvis (Merge!)
  - Fins i tot podem tenir tests del manual!

---
## Documentaci√≥ d'usuari (format)

Hi ha dos formats de text pla que s√≥n ampliament reconeguts:
- ReStructuredText
- Markdown (ho est√† petant!)

---
## Documentaci√≥ d'usuari (format)

### ReStructuredText vs Markdown

#### ReStructuredText

- üîù Sphinx √©s una de les millors eines de generaci√≥ de documentaci√≥
- üîù Molt potent. Suporta refer√®ncies, notes de peu, bibliografia
- üîù Moltes, moltes i moltes extensions
- ‚ùå Sint√†xis for√ßa complexe

#### Markdown

 - üîù Sint√†xis senzilla
 - ‚ùå Hi ha diferents "sabors" -> [CommonMark](http://commonmark.org/)
 - ‚ùå Poques funcionalitats avan√ßades
---
## Documentaci√≥ d'usuari (eines)

- Ja hem parlat d'[Sphinx](#14)
- Presentem tamb√© una eina per Markdown: [MKdocs](http://www.mkdocs.org/)
  - No te tants suports de sortida com ReStructuredText + Sphinx
  - D'una forma f√†cil pots tenir una p√†gina amb manual d'usuari
  - M√©s f√†cil col¬∑laboraci√≥ per membres no t√®cnics
  - Extensible amb totes les extensions de [Python-Markdown](https://pythonhosted.org/Markdown/)
- Publicaci√≥: [ReadTheDocs](https://readthedocs.org/)

### Cicle possible

1. Creem una branca per afegir/modificar documentaci√≥
2. Work and commit
3. Push!
4. Pull-request
5. Testing (el format √©s v√†lid, hi ha traduccions?, faltes d'ortografia, ...)
6. Construcci√≥ del lloc temporal amb els canvis
7. Revisi√≥
8. Merge
9. Publicaci√≥ autom√†tica nova versi√≥


---

# Testing: Metodologia TDD i cl√†ssica

- Qu√® √©s testing?
- Qu√® √©s TDD?
- Metodologia cl√†ssica (Unittests?)
- Qu√® ens aporta TDD?


---

# Integraci√≥ (Cont√≠nua)

- Qu√® √©s integraci√≥ continua?
- Avantatges
- Quins entorns hi ha?

---

# Desplegament

- Qu√® √©s desplegar?
- De forma manual, semi-autom√†tica i autom√†tica
- Eines

---

# Monitoritzar

- Per qu√® √©s imporant monitoritzar?
- Ser pro-actius
- M√©s informaci√≥ de l'error
- Eines que hi ha.

    </textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create({
        highlightStyle: 'darcula',
        highlightLanguage: 'python'
      });
    </script>
  </body>
</html>
